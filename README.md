# 🧪 PDCA-Lab (HypoLab) - 習慣トラッカー

高度なゲーミフィケーション機能を備えた習慣形成支援アプリケーション

## 📱 デモ
[https://yusuke0018.github.io/PDCA-Lab/](https://yusuke0018.github.io/PDCA-Lab/)

## 🎯 概要

HypoLabは、習慣形成を科学的かつ楽しくサポートするWebアプリケーションです。PDCAサイクルとゲーミフィケーション要素を豊富に取り入れ、モチベーションを維持しながら良い習慣を身につけることができます。

### 主な特徴
- 🎲 ランダムな検証期間（3-30日）で飽きない習慣形成
- 🎴 報酬カードシステムによる戦略的な習慣管理
- 🏆 20種類以上のバッジシステムによる達成感の可視化
- 🌱 7段階の成長ステージで習慣の定着度を可視化
- 📊 詳細な統計とレポート機能
- 📝 アウトプット記録で日々の学びを蓄積
- 📱 PWA対応でスマートフォンでも快適に利用可能

## ✨ 主な機能

### 1. 🧪 習慣管理システム

#### 基本機能
- **習慣の作成と管理**
  - タイトルと詳細説明を設定
  - 目的（ベネフィット）を明確化
  - 検証期間をランダムに決定（3-30日）
  - IF-THENルールで実行トリガーを設定

#### 頻度設定
- **毎日実施**: デフォルト設定
- **週N回実施**: 週単位での回数指定（1-7回）
- **曜日指定**: 特定の曜日のみ実施

#### 習慣モード
- **通常モード**: 期間終了で完了
- **習慣モード**: 21日継続で自動的に習慣化
- **無期限モード**: 期限なしで継続

### 2. 🌱 成長ステージシステム

習慣の継続日数に応じて7段階のステージが設定されています：

1. **🌱 種（Seed）**: 0-2日 - 習慣の種まき
2. **🌿 芽（Sprout）**: 3-6日 - 習慣が芽生える
3. **🌳 成長（Growth）**: 7-13日 - 着実な成長
4. **🎋 定着（Establishment）**: 14-20日 - 習慣として定着
5. **🌸 開花（Bloom）**: 21-29日 - 成果が見え始める
6. **🍎 収穫（Harvest）**: 30-59日 - 習慣の恩恵を収穫
7. **👑 黄金（Golden）**: 60日以上 - 完全に習慣化

各ステージアップ時には通知が表示され、成長を実感できます。

### 3. 🏆 バッジシステム（20種類以上）

#### 連続達成バッジ
- 🔥 **週間戦士**: 7日連続達成
- ⚡ **2週間の炎**: 14日連続達成
- 💎 **21日マスター**: 21日連続達成（習慣形成の目安）
- 👑 **月間レジェンド**: 30日連続達成

#### ステージバッジ
- 🌱 **最初の一歩**: 種ステージ到達
- 🌿 **成長の兆し**: 芽ステージ到達
- 🌳 **着実な成長**: 成長ステージ到達
- 🎋 **習慣の定着**: 定着ステージ到達
- 🌸 **開花の瞬間**: 開花ステージ到達
- 🍎 **実りの収穫**: 収穫ステージ到達
- 👑 **黄金の習慣**: 黄金ステージ到達

#### 完璧達成バッジ
- 💯 **完璧主義者**: 100%達成率で完了
- 🏃 **スピードランナー**: 3日間の習慣を100%達成
- 🗻 **マウンテンクライマー**: 30日間の習慣を100%達成

#### 特別バッジ
- 🌅 **早起き鳥**: 5日連続で朝6時前に達成
- 🦉 **夜型マスター**: 5日連続で夜10時以降に達成
- 🎯 **週末戦士**: 週末のみで10日達成
- 🔄 **復活の勇者**: 3日以上の中断から復帰
- 🌈 **多様性マスター**: 3つ以上の習慣を同時進行

### 4. 🎴 カードシステム

#### 報酬カード（11種類）
- **⏭️ スキップチケット**: 未達成の日を達成扱いにする
- **🌟 達成ブースト**: 指定期間の達成率を2倍にする
- **🎯 パーフェクトボーナス**: 100%達成で報酬カード2枚
- **🔄 延長チケット**: 期間を3日延長
- **📅 期間短縮**: 全体期間を10%短縮
- **♾️ 無期限チケット**: 習慣を無期限に変更
- **🎁 ボーナスカード**: 追加でカード1枚獲得
- **⏮️ リワインド**: 開始日を3日前に変更
- **🔮 リセット**: 未達成日を全てリセット
- **🛡️ プロテクトシールド**: ペナルティカード無効化
- **🔄 セカンドチャンス**: 終了後3日間の追加挑戦

#### ペナルティカード（5種類）
- **⏸️ フリーズ**: 3日間進捗が停止
- **😈 ハードモード**: 90%以上でないとカード獲得不可
- **⏱️ タイムリミット**: 期間が強制的に短縮
- **📉 マイナススタート**: 達成率-10%から開始
- **🎲 ダブルオアナッシング**: 100%達成できないとペナルティ2枚

### 5. 💪 強度（Intensity）システム

各習慣に3段階の強度ラベルを設定可能：
- **ライト（1倍）**: 軽い負荷
- **ミディアム（1.5倍）**: 中程度の負荷
- **ヘビー（2倍）**: 高い負荷

強度に応じて報酬が増加し、より効果的な習慣形成が可能です。

### 6. 🎯 IF-THENプランニング

習慣実行のトリガーを事前に設定：
- **IF（条件）**: いつ、どんな状況で
- **THEN（行動）**: 何をするか

例：「IF: 朝起きたら」「THEN: 水を一杯飲む」

### 7. 📝 アウトプット記録機能

日々の振り返りと成長の記録：
- **学び・気づき・成果を記録**: テキストエリアで自由記述
- **タイムスタンプ付き保存**: いつ記録したかを自動記録
- **履歴表示**: 最新5件の履歴を自動表示
- **習慣ごとの管理**: 各習慣に独立したアウトプット記録

### 8. 📊 統計・レポート機能

#### リアルタイム統計
- **総習慣数**: 現在進行中と完了した習慣の総数
- **平均達成率**: 全習慣の平均達成率
- **獲得カード数**: 報酬カードとペナルティカードの枚数
- **連続達成日数**: 現在のストリーク
- **ステージ別進捗**: 各習慣のステージ分布

#### 月次・年次レポート
- **期間内の習慣数と達成率**: 月/年単位での成果
- **最も成功した習慣TOP3**: 達成率ランキング
- **獲得したバッジ一覧**: 期間中に獲得したバッジ
- **カード使用統計**: カードの獲得と使用状況
- **成長グラフ**: 時系列での成長推移

#### データエクスポート
- **JSON形式でエクスポート**: 全データをJSON形式で保存
- **バックアップ・復元機能**: データの安全な保管
- **他デバイスへの移行**: エクスポート/インポートで移行可能

### 9. 🎮 ゲーミフィケーション要素

#### ランキングシステム
- **習慣ごとの達成率ランキング**: TOP5を表示
- **順位に応じた特別報酬**: 上位ランクで追加報酬
- **競争と協力**: 自分との戦いを可視化

#### ストリーク機能
- **連続達成日数の可視化**: カレンダーで一目瞭然
- **ストリークボーナス**: 連続達成で報酬増加
- **復活チャンス**: セカンドチャンスカードで継続

#### シャッフルアニメーション
- **検証期間決定時のスロット演出**: ワクワク感を演出
- **カード獲得時のエフェクト**: 達成感を視覚的に表現
- **ステージアップ時の特別演出**: 成長を祝福

### 10. 📱 ユーザビリティ機能

#### PWA対応
- **ホーム画面への追加**: アプリのように使用可能
- **オフライン対応**: ネット接続なしでも動作
- **高速起動**: ネイティブアプリ並みの速度

#### モバイル最適化
- **レスポンシブデザイン**: 全画面サイズに対応
- **スワイプ操作対応**: 直感的な画面遷移
- **タッチ最適化UI**: 大きめのタップターゲット

#### アクセシビリティ
- **ダークモード**: 目に優しい暗色テーマ
- **明確な視覚フィードバック**: 操作結果を即座に表示
- **シンプルで直感的なUI**: 誰でも使いやすい設計

## 🎮 使い方

### 初回セットアップ
1. アプリにアクセス（またはホーム画面に追加）
2. 「➕ 新規習慣作成」をタップ
3. 習慣内容を入力：
   - **タイトル**: 例「毎日10分の瞑想」
   - **詳細説明**: 習慣で実現したい内容
   - **期待する変化**: 例「集中力が上がる」
   - **IF-THENルール**: 任意（例：IF 朝起きたら THEN 瞑想する）

### 頻度と期間の設定
1. **実施頻度を選択**：
   - 毎日
   - 週◯回（スライダーで1〜7回を指定）
   - 特定の曜日（月〜日から複数選択可）

2. **検証期間を決定**：
   - シャッフルボタンで3-30日のランダムな期間が決定

### 日々の記録
1. ホーム画面から進行中の習慣をタップ
2. カレンダーで今日の日付をタップして達成記録
3. アウトプットエリアに学びや気づきを記録
4. 強度調整で負荷を変更可能

### カード使用
1. 進捗画面の「🎴 カードを使用」ボタンをタップ
2. 使用可能なカードから選択
3. 効果を適用して習慣継続をサポート

## 💡 活用例

### 運動習慣
- **習慣**: 「朝10分のストレッチで1日の集中力を上げる」
- **頻度**: 毎日
- **期間**: シャッフルで決定（3〜30日）
- **IF-THEN**: IF 起床したら THEN ストレッチマットを広げる
- **アウトプット**: 体の変化や集中力の変化を記録

### 学習習慣
- **習慣**: 「週3回の英語学習でTOEICスコアアップ」
- **頻度**: 週3回
- **期間**: シャッフルで決定
- **IF-THEN**: IF 夕食後 THEN 英語アプリを開く
- **アウトプット**: 学んだ単語や表現を記録

### 生活改善
- **習慣**: 「23時就寝で朝の目覚めを改善」
- **頻度**: 月〜金の特定曜日
- **期間**: シャッフルで決定
- **IF-THEN**: IF 22:30になったら THEN スマホを充電器に置く
- **アウトプット**: 睡眠の質や朝の体調を記録

## 🚨 開発ガイドライン（重要）

### 画面表示バグを防ぐための必須確認事項

#### 1. JavaScript初期化の確認
**問題**: 初期化処理が実行されないと画面に何も表示されない
```javascript
// ❌ 悪い例：初期化関数を呼び出していない
showHomeView();

// ✅ 良い例：DOMContentLoadedで確実に初期化
document.addEventListener('DOMContentLoaded', () => {
    initializeApp();
});
```

#### 2. 変数の重複宣言を避ける
**問題**: 同じスコープで変数を重複宣言するとSyntaxError
```javascript
// ❌ 悪い例：同じスコープで重複宣言
const currentView = getCurrentView();
// ... 他の処理 ...
const currentView = getCurrentView(); // Error!

// ✅ 良い例：既存の変数を再利用
const currentView = getCurrentView();
// ... 他の処理でcurrentViewを使用 ...
```

#### 3. 関数の存在確認
**問題**: 未定義の関数を呼び出すとエラーで処理が停止
```javascript
// ❌ 悪い例：関数の存在を確認せずに呼び出し
updateCardInventory(); // 関数が存在しない場合エラー

// ✅ 良い例：存在確認またはtry-catchで保護
if (typeof updateCardInventory === 'function') {
    updateCardInventory();
}
```

#### 4. DOM要素の存在確認
**問題**: 存在しないDOM要素にアクセスするとnullエラー
```javascript
// ❌ 悪い例：要素の存在を確認せずにアクセス
document.getElementById('element-id').innerHTML = 'content';

// ✅ 良い例：存在確認してからアクセス
const element = document.getElementById('element-id');
if (element) {
    element.innerHTML = 'content';
}
```

### デバッグ手順

#### 1. コンソールエラーの確認
1. ブラウザの開発者ツールを開く（F12）
2. Consoleタブでエラーメッセージを確認
3. エラーの行番号をクリックして問題箇所を特定

#### 2. 初期化処理の確認
```javascript
// デバッグ用ログを追加
console.log('初期化開始');
showHomeView();
console.log('ホーム画面表示');
updateCurrentHypothesisList();
console.log('習慣リスト更新');
```

#### 3. データの確認
```javascript
// LocalStorageのデータを確認
const data = JSON.parse(localStorage.getItem('hypolab_local_data'));
console.log('保存データ:', data);
```

### テスト項目（リリース前必須）

- [ ] ページ読み込み時に習慣リストが表示される
- [ ] ナビゲーションバーが正しく動作する
- [ ] 新規習慣の作成ができる
- [ ] 習慣の達成記録ができる
- [ ] 統計画面が正しく表示される
- [ ] カード画面が正しく表示される
- [ ] スマホでの表示が崩れていない
- [ ] コンソールにエラーが出ていない

## 🛠️ 技術仕様

### 対応環境
- **デバイス**: スマートフォン、タブレット、PC
- **ブラウザ**: Chrome 90+, Safari 14+, Firefox 88+, Edge 90+
- **PWA対応**: ホーム画面に追加してアプリとして使用可能

### データ構造
```javascript
{
  currentHypotheses: [],      // 現在の習慣
  completedHypotheses: [],    // 完了した習慣
  cards: {
    inventory: [],            // 所持カード
    activeEffects: []         // アクティブな効果
  },
  badges: [],                 // 獲得バッジ
  statistics: {               // 統計データ
    totalHabits: 0,
    averageAchievement: 0,
    currentStreak: 0
  },
  outputs: {}                 // アウトプット記録
}
```

### 技術スタック
- **フロントエンド**: HTML5, CSS3, Vanilla JavaScript
- **データ保存**: LocalStorage（ブラウザ内保存）
- **PWA**: Service Worker, Web App Manifest
- **アニメーション**: CSS Animations, Canvas API
- **デザイン**: ダークテーマ、グラデーション、レスポンシブ

## 📊 カード獲得確率

### 達成率による獲得
- **100%達成**: 
  - レジェンダリーカード: 15%
  - レアカード: 35%
  - コモンカード: 50%
- **80-99%達成**: 
  - レアカード: 20%
  - コモンカード: 80%
- **60-79%達成**: カードなし
- **0-59%達成**: ペナルティカード1枚

## 🚀 インストール方法

### Webアプリとして使用
1. ブラウザで以下のURLにアクセス
   - [https://yusuke0018.github.io/PDCA-Lab/](https://yusuke0018.github.io/PDCA-Lab/)
2. ブックマークに追加して使用

### PWAとしてインストール
1. モバイルブラウザでアプリを開く
2. 「ホーム画面に追加」を選択
3. アプリアイコンから起動

### ローカルで使用
```bash
# リポジトリをクローン
git clone https://github.com/Yusuke0018/PDCA-Lab.git
cd PDCA-Lab

# ブラウザで開く
open hypolab-local.html  # Mac
start hypolab-local.html # Windows

# またはローカルサーバーで配信
python3 -m http.server 8080
# http://localhost:8080 を開く
```

## 🔧 今後の開発予定

### 近日実装予定（Phase 1）
- [ ] **ポイントシステムの拡張**
  - [ ] デイリーチャレンジ機能（特定条件でボーナスポイント）
  - [ ] ウィークリーチャレンジ機能
  - [ ] 時間帯ボーナス（早朝/深夜回避）
  - [ ] ポイント獲得時のアニメーション強化
  
- [ ] **報酬システムの改善**
  - [ ] 報酬のお気に入り機能
  - [ ] 報酬の編集機能
  - [ ] カテゴリー別フィルタリング
  - [ ] 報酬の並び替え機能

### 中期実装予定（Phase 2）
- [ ] **ゲーミフィケーション強化**
  - [ ] アチーブメント/実績システム
  - [ ] ポイントランキング（自己ベスト）
  - [ ] 特別イベント（期間限定ボーナス）
  - [ ] カード×ポイント連携機能

- [ ] **データ分析強化**
  - [ ] ポイント獲得グラフ
  - [ ] 報酬使用傾向分析
  - [ ] 習慣別のポイント効率表示

### 長期実装予定（Phase 3）
- [ ] クラウド同期機能
- [ ] ソーシャル機能（友達と習慣をシェア）
- [ ] AIによる習慣提案
- [ ] カスタムテーマ設定
- [ ] 音声入力対応
- [ ] ウィジェット機能
- [ ] プッシュ通知（リマインダー）
- [ ] データのインポート/エクスポート強化
- [ ] 習慣テンプレート

## ❓ よくある質問

**Q. データはどこに保存されますか？**
A. ブラウザのローカルストレージに保存されます。定期的にエクスポート機能でバックアップすることをお勧めします。

**Q. 複数デバイスで同期できますか？**
A. 現在はローカル保存のみです。エクスポート/インポート機能（開発予定）で手動移行が可能になります。

**Q. バッジを失うことはありますか？**
A. 一度獲得したバッジは永続的に保存されます。

**Q. 習慣を削除するには？**
A. 習慣カードを長押し（スマホ）または右クリック（PC）で削除できます。

**Q. アウトプットの文字数制限は？**
A. 特に制限はありませんが、長文の場合は外部メモアプリとの併用をお勧めします。

## 📄 ライセンス

MIT License

## 👤 作者

Yusuke0018

## 🤝 コントリビューション

不具合報告や改善提案を歓迎します！
- [Issues](https://github.com/Yusuke0018/PDCA-Lab/issues)で報告
- Pull Requestで改善提案

## 📞 サポート

質問や要望は[Issues](https://github.com/Yusuke0018/PDCA-Lab/issues)までお願いします。

## 📝 更新履歴

### 2025年1月13日 - ポイントシステム＆報酬機能の実装 🎉

#### 🎮 新機能追加 - ポイントシステム

##### 基本機能
1. **ポイント獲得システム**
   - 習慣達成時に強度別ポイント獲得（ライト:1pt、ミディアム:2pt、ヘビー:3pt）
   - 連続達成ボーナス（3日:1.2倍、7日:1.5倍、14日:1.7倍、21日:2.0倍）
   - コンボボーナス（2習慣:+1pt、3習慣:+3pt、全習慣:+5pt）
   - 努力ボーナス（1日最大3回、各1-3pt選択可能）

2. **レベルシステム**
   - Lv.1 初心者（0-50pt）からLv.10 超越者（2601pt+）まで
   - 厳しめの設定で長期的な楽しみを提供
   - レベルアップ時の通知機能

3. **報酬システム**
   - 完全カスタマイズ可能な報酬作成
   - 名前、必要ポイント、絵文字、カテゴリー、メモを設定
   - ポイントを消費して報酬を獲得
   - 使用回数の記録と管理

4. **統計機能**
   - 現在ポイント、累計獲得/消費の表示
   - レベル進捗バーでビジュアル化
   - 最近の取引履歴（最新10件）
   - 統計画面に専用セクション追加

5. **UI/UX改善**
   - ヘッダーにポイント・レベル常時表示
   - 新規「💰 ポイント」画面追加
   - 3タブ構成（報酬/履歴/作成）
   - ゴールドグラデーションの特別デザイン

### 2025年1月 - 主要な修正と改善

#### 🐛 バグ修正
1. **習慣画面の表示バグを修正**
   - 初期化処理の問題で習慣が表示されない不具合を解決
   - DOMContentLoadedイベントで確実に初期化されるように修正
   - 重複した変数宣言によるSyntaxErrorを解消

2. **統計画面のスワイプ機能を修正**
   - スワイプイベントが発火しない問題を根本的に解決
   - 変数スコープの問題を修正（ローカル変数をグローバルに移動）
   - 統計画面専用のイベントリスナーを追加
   - キャプチャフェーズでイベントを確実に捕捉

3. **モバイル表示の改善**
   - 曜日別達成率の数字が重なる問題を修正
   - フォントサイズとレイアウトを最適化
   - レスポンシブデザインの改善

#### ✨ 新機能
1. **習慣のグループ表示機能**
   - ホーム画面で習慣を頻度別にグループ化
   - 「毎日の習慣」「週●回の習慣」「特定曜日の習慣」に分類
   - 視覚的なヘッダーと頻度バッジを追加

2. **デバッグツールの追加**
   - `debug-test.html` - 包括的なデバッグ用ツール
   - LocalStorageデータの確認・クリア機能
   - リアルタイムコンソールログキャプチャ
   - 6つの自動テスト項目

#### 🔧 技術的改善
1. **コード品質の向上**
   - 未定義関数の呼び出しを削除
   - エラーハンドリングの強化
   - デバッグログの追加による問題特定の容易化

2. **データ構造の修正**
   - 週間習慣の頻度データ構造を修正
   - `frequency.type` と `frequency.count` の正しい参照

3. **開発ガイドラインの追加**
   - READMEに開発時の注意事項を明記
   - 画面表示バグを防ぐためのチェックリスト
   - デバッグ手順の文書化

#### 🎯 今後の課題
- パフォーマンスの最適化
- より詳細なエラーログの実装
- ユニットテストの追加

---

**習慣形成は小さな一歩から。HypoLabで楽しく習慣を身につけよう！** 🚀

© 2025 HypoLab - 習慣トラッカー