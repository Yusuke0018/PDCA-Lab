# PDCA-Lab 🚀

習慣化を支援するPWA（Progressive Web App）アプリケーション。PDCAサイクルを可視化し、日々の成長を記録・管理できます。

## 🌟 主な機能

### 📊 習慣トラッカー
- **目標設定**: 習慣化したい項目を登録
- **頻度設定**: 
  - 毎日、週●回、特定曜日から選択可能
  - 週●回の習慣は目標達成後も追加記録可能
- **進捗管理**: 毎日の実行状況を記録
- **カレンダー表示**: 月次での達成状況を可視化
- **統計情報**: 連続記録日数、達成率などの確認
- **カテゴリ管理**: 勉強、運動、健康など6つのカテゴリで分類
 - **IFルール**: IF-THENから簡素化し、「IF（もし）」のみを登録可能（行動文の入力は不要）

### 💎 ポイントシステム
- **ポイント獲得**: 習慣達成でポイントを獲得
- **ブーストカード**: 限定的な効果でポイント獲得を増幅
- **ストリークボーナス**: 連続達成でボーナスポイント
- **リワード交換**: 貯めたポイントで報酬と交換
 - **新カード（例）**:
   - 🌈 ミニレインボー: 今日だけ全カテゴリ×1.2
   - 😴 パワーナップ: 30分間、達成ごとに+5pt
   - 🧨 コンボサージ: 今日のコンボ×1.5
   - ☕ アフタヌーンジェム: 今日のポイント×1.2
   - 🎫 イベントチケット: 今日に「ダブルポイントデー」を発動（×2）
   - 🎯 チャレンジブースト: 今日のチャレンジポイント×2
   - 📝 ジャーナルブースト: 今日のジャーナルポイント×2

### 📝 デイリージャーナル
- **朝のジャーナル**: 体調・気分・今日の最優先事項を記録
- **夜のジャーナル**: うまくいったこと・改善点を振り返り
- **ストリーク管理**: 連続記録日数とボーナス
- **削除機能**: 
  - **PC**: 右クリックでコンテキストメニューから削除
  - **スマホ**: 長押し（0.5秒）でコンテキストメニューから削除
  - 削除時はブースト効果を考慮してポイントが減算される
- **ブースト**: 「ジャーナルブースト」カード使用時は当日のジャーナル獲得ポイントが×2
 - **睡眠分析**:
   - 30日間の睡眠時間推移（簡易グラフ）
   - 睡眠と体調/気分の相関（Pearson相関係数）
   - 睡眠と当日/前日の習慣達成率の相関（0〜1の達成率を用いて計算）

### 💪 努力ボーナス（今日の目標）
- **目標設定**: 今日達成したいことを目標として設定
- **ポイント選択**: 1〜3ポイントから難易度に応じて選択
- **達成管理**: 完了ボタンを押してポイント獲得
- **削除機能**: 誤って追加した目標は削除可能
- **進捗表示**: 未完了/完了の件数をリアルタイムで表示

### 🎯 チャレンジシステム
- **デイリーチャレンジ**: 毎日更新される目標
- **ウィークリーチャレンジ**: 週単位の大きな目標
- **カスタムチャレンジ**: 自分で作成する独自の目標
- **報酬**: チャレンジ達成でポイント獲得
 - **ブースト**: 通常はブースト非対象。カード「チャレンジブースト」やイベントで明示的に倍率が有効な日のみ×2などが適用

### 💡 インサイト機能
- **週次レポート**: 1週間の振り返りと改善提案
- **月次レポート**: 月間の成長分析
- **AIコメント生成**: OpenAI APIを使用した洞察
- **パターン分析**: 習慣の傾向と成功要因の把握

### 📤 データ管理
- **エクスポート**: 全データをJSON形式でダウンロード
  - 習慣データ、ジャーナル、ポイント、設定などすべて含む
- **インポート**: エクスポートしたデータから完全復元
  - バックアップや端末間のデータ移行に対応
- **ローカルストレージ**: データはブラウザに安全に保存

## 🚀 使い方

### インストール
1. [アプリケーションURL]にアクセス
2. ブラウザのメニューから「ホーム画面に追加」を選択
3. PWAとしてインストール完了

### 基本操作
1. **習慣の登録**: ホーム画面の「＋」ボタンから習慣を追加
2. **記録**: 習慣タイルをタップ/クリックで達成を記録
3. **ジャーナル**: 朝夜のジャーナルボタンから記録を作成
4. **ポイント確認**: 上部のポイント表示で現在のポイントを確認

### ジャーナルの削除方法
- **PC**: ジャーナルエントリを右クリック → 「削除」を選択
- **スマホ**: ジャーナルエントリを0.5秒長押し → 「削除」を選択
- **注意**: 削除するとブースト効果を含む獲得ポイントが減算されます

### データのバックアップ
1. 設定画面 → 「データをエクスポート」をクリック
2. JSONファイルがダウンロードされる
3. 復元時は「データをインポート」からファイルを選択

## 🔧 技術仕様

### フロントエンド
- **HTML5/CSS3/JavaScript**: PWA対応のシングルページアプリケーション
- **LocalStorage API**: データの永続化
- **Service Worker**: オフライン対応とキャッシュ管理

### 特徴
- **完全オフライン対応**: インターネット接続不要
- **レスポンシブデザイン**: PC/タブレット/スマホ対応
- **ダークモード**: 目に優しいダークテーマ
- **高速動作**: ローカル処理による即座の反応

### ポイント計算
- **基本ポイント**: 各アクション（習慣達成、ジャーナル記録など）で1pt
- **ブースト**: カードやイベントによる倍率（1.5x〜3.0x）
- **ストリークボーナス**: 7日連続で+5pt、30日連続で+20pt
 - **適用範囲の注意**:
   - チャレンジのポイントは原則ブースト対象外（「チャレンジブースト」カードや専用イベント発動時のみ倍率適用）
   - ジャーナルは「ジャーナルブースト」カード使用日に限り倍率適用

## 📱 対応環境

### ブラウザ
- Chrome 90+
- Safari 14+
- Firefox 87+
- Edge 90+

### デバイス
- iOS 14.0+
- Android 8.0+
- Windows 10+
- macOS 10.15+

## 🔒 プライバシー

- すべてのデータはローカルに保存
- 外部サーバーへの送信なし（AIコメント生成時のみAPI通信）
- アカウント登録不要
- 完全にプライベートな使用が可能

## 📝 更新履歴

### v3.8.1 (2025年8月16日)
- 新カードを追加（軽量で安全な効果）
  - 🌈 ミニレインボー（全カテゴリ×1.2、当日）/ 😴 パワーナップ（30分 +5pt）/ 🧨 コンボサージ（コンボ×1.5、当日）
  - ☕ アフタヌーンジェム（ポイント×1.2、当日）/ 🎫 イベントチケット（今日のイベントにダブルポイント×2を発動）
  - 🎯 チャレンジブースト（今日のチャレンジ×2）/ 📝 ジャーナルブースト（今日のジャーナル×2）
- カテゴリーフェス: ホーム画面のカテゴリフィルター選択を自動参照。未選択時はカテゴリ選択ダイアログを表示
- 変換の魔法: ドロップ出現率を1%に調整（外れた場合は他カードを均等抽選）
- プロテクトシールド: 廃止（所持していても新規付与・使用不可の扱いに統一）
- IF-THENルール: THEN（行動）入力を廃止し、IF（トリガー）のみ登録に簡素化
- 新規習慣立案: 「朝の1行宣言」入力を廃止（作成時の必須チェックも撤廃）
- ジャーナル統計: 睡眠分析を強化（30日トレンド、体調/気分/達成率との相関）
 - ジャーナル統計: 「記録時間帯分析」セクションを廃止（記録時刻は保持しない方針に変更）

### v3.8.0 (2025年8月15日)
- UI/UX強化（ライトテーマ＋ガラス質感）
  - ライトモードの配色・陰影を刷新。薄いガラスレイヤー＋ぼかし＋繊細な境界線で視認性と上品さを両立
  - `hypolab.html`にもライトテーマを実装し、ヘッダー/ナビ/カード/コンテナを最適化（テーマ切替ボタン追加）
- ナビゲーションの操作感向上
  - タブ下に“スライドピル”インジケーターを実装（切替時にスッと移動）
  - 画面左右に小さな突起（エッジナブ）を追加。タップで前後ページへ移動（進捗/シャッフルでは非表示）
- スワイプ体験の改善（スマホ最適化）
  - 全体のしきい値を見直し、横優先・端スワイプ（左右24px内）を高感度化
  - 統計/ポイント/履歴/カード上でもスワイプが通るよう専用リスナーと`preventDefault`制御を実装
  - 履歴・カード画面は特に感度を強化（短距離・横優先）
- FAB（右下）クイックアクションの拡充
  - 追加: 新しい習慣（➕）/ 今日のジャーナル（📝）/ 報酬（💎）/ 報酬を使う（🎁）
  - 「今日の達成」は仕様変更により削除
- 祝祭演出（軽量）
  - レベルアップ/バッジ獲得時にコンフェッティ（短時間・低負荷）＋ガラス調ミニモーダル
  - バッジ獲得は中央ショーケース（絵文字＋名称）を1秒強だけ表示
- 獲得バッジのトグル不具合を修正
  - モバイルCSSの`display: grid !important`を是正し、`.is-hidden`クラスで表示制御に統一
  - ホーム復帰時は統計・カテゴリの各トグルを自動的に閉じるよう調整
- そのほか
  - 今日のジャーナルなどの背景をライト用の淡色グラデ＋ガラス処理に最適化

＜使い方の補足＞
- テーマ切替: 右上のアイコン（🌙/☀️）でダーク/ライトを切替
- クイックアクション（右下＋）:
  - ➕ 新しい習慣を作成 / 📝 今日のジャーナル / 💎 報酬タブを開く / 🎁 報酬を使う（リストへ自動スクロール）
- ページ移動: 左右スワイプ、または左右の小さな突起（‹/›）をタップ

### v3.7.0 (2025年1月15日)
- **努力ボーナスシステムの改善**
  - 🎯 努力ボーナスを「目標設定→完了」の2段階システムに変更
  - 📋 目標として登録し、達成後に完了ボタンでポイント獲得
  - 🗑️ 誤って追加した目標は削除可能
  - 📊 未完了/完了の目標件数をホーム画面に表示
  - ✨ より自然な日本語表現に改善（「努力を予定」→「目標を追加」）
- **習慣トラッキングの改善**
  - 📈 週●回の習慣で目標達成後も追加記録可能に
  - 🔢 規定回数を超えても継続して記録できる仕様に変更
- **カテゴリシステムの統一**
  - 🏷️ カテゴリマスターによる一元管理を実装
  - 🔄 全画面でカテゴリが同期されるように改善

### v3.6.1 (2025年1月15日)
- **バグ修正**
  - 🔧 カテゴリマスター機能のエラーを修正
  - ⚠️ JavaScriptエラーでホーム画面が表示されない問題を解決
  - 🛡️ 初期化処理にエラーハンドリングを追加
- **開発者向けドキュメント**
  - 📚 バグの再発防止策をREADMEに記載
  - 🔍 デバッグ方法とテスト方法を明記
  - ✅ 開発時のチェックリストを追加

### v3.6.0 (2025年1月15日)
- **ジャーナル機能の改善**
  - 📊 ジャーナルエントリの展開/折りたたみ機能を追加
  - 📚 過去30日分のジャーナル履歴表示機能を追加
  - ✨ 朝（体調・気分・最優先事項）と夜（うまくいったこと・改善点）の内容を詳細表示
  - 🔍 クリックで内容を展開、アイコンが回転して開閉状態を表示
- **カテゴリ連動機能を追加**
  - 🔗 ホーム画面のカテゴリフィルターと新規習慣作成画面が連動
  - 📂 ホーム画面で習慣をカテゴリ別にフィルタリング可能
  - 💾 選択したカテゴリは保存され、新規習慣作成時に自動設定
- **機能の簡素化**
  - 🗑️ 「今日の宣言」機能を削除してシンプルな操作性を実現
  - ✅ 習慣トラッキングの基本機能に集中
  - 🔄 IF-THENルール機能は維持

### v3.5.0 (2025年1月14日)
- **ポイント統計機能を大幅拡充**
  - 📈 30日間のポイント推移グラフ
  - 🎯 獲得ソース別分析（習慣、ジャーナル、チャレンジなど）
  - ⏰ 時間帯別獲得パターン（6つの時間帯で分析）
  - 🚀 ブースト効果分析（平均倍率、最大倍率、ブースト獲得率）
- **習慣ランキング機能を拡充**
  - 📊 達成率ランキング（達成率と総日数を表示）
  - 💰 ポイントランキング（総獲得ポイント、平均ポイント、ブーストボーナス）
  - 🔥 連続ランキング（現在の連続日数、最長記録、累計日数）
  - 🥇🥈🥉 上位3位にメダル表示とグラデーション背景
- **データエクスポート/インポート機能の改善**
  - 全データの完全バックアップ/復元に対応
  - 旧形式（v1.0）との互換性維持
  - データ形式の自動判定機能
  - 必須プロパティの自動補完
- **レベルシステムの調整**
  - レベルアップに必要なポイントを1.5倍に調整
  - より長期的な目標設定で達成感を向上

### v3.4.0 (2025年1月14日)
- **ジャーナル統計機能を大幅拡充**
  - 📈 感情推移グラフ（30日間）
  - 🗓️ 曜日別パターン分析
  - 📅 月別記録率と感情推移
  - ⏰ 時間帯別記録パターン分析
  - 🔗 感情と習慣達成率の相関分析
  - ☁️ よく使うキーワードのワードクラウド表示
- **深夜対応機能**
  - 深夜2時まで前日扱いで記録可能（ジャーナル・習慣共通）
- **UIエフェクト改善**
  - 💪 努力ボーナスボタンにクリックエフェクト追加（星のパーティクル）
- **バグ修正**
  - 習慣達成取り消し時のコンボボーナス計算を修正
  - 統計画面のAndroidレイアウト問題を修正

### v3.3.0 (2025年1月)
- ジャーナル削除機能を追加
- コンテキストメニュー方式に変更（右クリック/長押し）
- ブースト効果を考慮したポイント減算処理
- データエクスポート/インポート機能
- UI/UXの改善

### v3.2.0
- デイリージャーナル機能追加
- ストリークシステム実装
- インサイト機能強化

### v3.1.0
- ポイントシステム導入
- ブーストカード実装
- チャレンジシステム追加

### v3.0.0
- 初回リリース
- 基本的な習慣トラッカー機能
- PWA対応

## 🔧 開発者向けガイドライン

### 🚫 バグの再発防止策

#### よくあるバグと対策

##### 1. ホーム画面が表示されない・ナビゲーションが動かない
**原因**: JavaScriptエラーで初期化処理が止まる

**防止策**:
```javascript
// ✗ 悪い例：エラーハンドリングなし
function initializeApp() {
    updateCategoryDropdowns();  // この関数が存在しないと全て止まる
    showHomeView();
}

// ○ 良い例：エラーハンドリングあり
function initializeApp() {
    try {
        updateCategoryDropdowns();
    } catch (e) {
        console.error('カテゴリ初期化エラー:', e);
    }
    showHomeView();  // エラーがあってもホーム画面は表示される
}
```

##### 2. 関数が未定義エラー
**原因**: 関数を定義する前に呼び出している

**防止策**:
```javascript
// ✗ 悪い例
function editCategoryMaster() {
    addNewCategory();  // まだ定義されていない
}

// ○ 良い例
function addNewCategory() {
    // 先に定義
}

function editCategoryMaster() {
    addNewCategory();  // 定義後に使用
}

// または、windowオブジェクトに登録
window.addNewCategory = addNewCategory;
```

##### 3. DOM要素が見つからないエラー
**原因**: 要素がまだ存在しない、またはIDが間違っている

**防止策**:
```javascript
// ✗ 悪い例
const element = document.getElementById('category-filter');
element.value = 'all';  // elementがnullだとエラー

// ○ 良い例
const element = document.getElementById('category-filter');
if (element) {
    element.value = 'all';
}
```

#### 開発時のチェックリスト

✅ **新機能追加時**
- [ ] 新しい関数は定義してから使用しているか？
- [ ] windowオブジェクトへの登録が必要な場合、登録しているか？
- [ ] DOM要素の存在チェックをしているか？
- [ ] try-catchでエラーハンドリングをしているか？

✅ **初期化処理の変更時**
- [ ] initializeApp関数内の処理にtry-catchで囲まれているか？
- [ ] 重要な処理（ホーム画面表示など）がtryブロックの外にあるか？
- [ ] コンソールでエラーが出ていないか確認したか？

#### デバッグ方法

**ブラウザの開発者ツールを使用**:
1. Chrome/Edge/FirefoxでF12キーを押す
2. Consoleタブを開く
3. 赤いエラーメッセージを確認
4. エラーの行番号をクリックして問題箇所を特定

**デバッグモードの有効化**:
URLに`?debug=true`を追加すると詳細なログが表示されます

#### テスト環境での確認事項

1. **ローカルストレージのクリア**
   - 開発者ツール → Application → Local Storage → Clear

2. **キャッシュのクリア**
   - Ctrl+Shift+R（Windows）またはCmd+Shift+R（Mac）

3. **スマホでのテスト**
   - 開発者ツールのデバイスモードを使用
   - iPhone/Androidの実機でも確認

#### 緊急時の対応

**バグが発生した場合**:
1. `git revert HEAD --no-edit` で前回のコミットを取り消し
2. `git push origin main` で即座にプッシュ
3. 落ち着いてから原因を調査

## 🤝 貢献

バグ報告や機能要望は[GitHubリポジトリ](https://github.com/yourusername/PDCA-Lab)のIssuesへお願いします。

## 📄 ライセンス

MIT License

---

Made with ❤️ by PDCA-Lab Team
